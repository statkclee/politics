# 데이터 과학자와 함께 하는 제19대 대통령 선거



## 페북 친구 네트워크 시각화 [^kateo-facebook-viz] [^facebook-igraph]

[^facebook-igraph]: [How to analyze your Facebook friends network with R](http://blog.revolutionanalytics.com/2013/11/how-to-analyze-you-facebook-friends-network-with-r.html)

페북 친구 네트워크를 시각화하는 코드는 지속적으로 진화를 해왔다. `igraph`를 활용하여 정적 네트워크 그래프 시각화 방법을 지나서,

[rthreejs](https://github.com/bwlewis/rthreejs)를 활용하여 웹브라우져에서도 정말 가볍게 네트워크 시각화가 가능하게 되었다.

1. `getNetwork()` 함수를 활용해서 본인 네트워크 정보를 가져온다.
1. `graph_from_adjacency_matrix` 함수로 인접행렬(Adjacent Matrix)을 `igraph` 객체로 변환한다.
    - `igraph` 함수 `degree` 정보를 추가한다.
1. 3D 자바스크립트 [three.js](https://threejs.org/)를 R에서 구현한 `threejs` 팩키지 `graphjs` 함수를 활용하여 3차원 시각화한다.


~~~{.r}
# 0. 환경설정 ---------------------------------------------------
## 0.1. 팩키지 불러오기

## 0.2. 토큰 설정
me_token <- "EAACEdEose0cBAFJbE5lwlt8s9lbZAmx5Nsrw5W4FgXraBViIqHi4L4MYXJ6bVlhYo4HG2ZBwyK8ZCTzr5bqLLK9xeZA1qeRHj8XmwOU1rDNM2zOAEmiZAQZBHgD3HYZChf9xEWZBoaZBpEpT2O8zEZChsjoMLkByZCXQqAg9XHgxFGp2FlcClZBl6MwGJg1gIkvK6lQZD"

# 1. 데이터 긁어오기 ---------------------------------------------------

my_network <- getNetwork(token = me_token, format="adj.matrix")
~~~



~~~{.output}
Only friends who use the application will be returned
See ?getFriends for more details

~~~



~~~{.output}

  |                                                                       
  |                                                                 |   0%
  |                                                                       
  |=                                                                |   2%
  |                                                                       
  |===                                                              |   4%
  |                                                                       
  |====                                                             |   6%
  |                                                                       
  |=====                                                            |   8%
  |                                                                       
  |======                                                           |  10%
  |                                                                       
  |========                                                         |  12%
  |                                                                       
  |=========                                                        |  14%
  |                                                                       
  |==========                                                       |  16%
  |                                                                       
  |===========                                                      |  18%
  |                                                                       
  |=============                                                    |  20%
  |                                                                       
  |==============                                                   |  22%
  |                                                                       
  |===============                                                  |  24%
  |                                                                       
  |=================                                                |  25%
  |                                                                       
  |==================                                               |  27%
  |                                                                       
  |===================                                              |  29%
  |                                                                       
  |====================                                             |  31%
  |                                                                       
  |======================                                           |  33%
  |                                                                       
  |=======================                                          |  35%
  |                                                                       
  |========================                                         |  37%
  |                                                                       
  |=========================                                        |  39%
  |                                                                       
  |===========================                                      |  41%
  |                                                                       
  |============================                                     |  43%
  |                                                                       
  |=============================                                    |  45%
  |                                                                       
  |===============================                                  |  47%
  |                                                                       
  |================================                                 |  49%
  |                                                                       
  |=================================                                |  51%
  |                                                                       
  |==================================                               |  53%
  |                                                                       
  |====================================                             |  55%
  |                                                                       
  |=====================================                            |  57%
  |                                                                       
  |======================================                           |  59%
  |                                                                       
  |========================================                         |  61%
  |                                                                       
  |=========================================                        |  63%
  |                                                                       
  |==========================================                       |  65%
  |                                                                       
  |===========================================                      |  67%
  |                                                                       
  |=============================================                    |  69%
  |                                                                       
  |==============================================                   |  71%
  |                                                                       
  |===============================================                  |  73%
  |                                                                       
  |================================================                 |  75%
  |                                                                       
  |==================================================               |  76%
  |                                                                       
  |===================================================              |  78%
  |                                                                       
  |====================================================             |  80%
  |                                                                       
  |======================================================           |  82%
  |                                                                       
  |=======================================================          |  84%
  |                                                                       
  |========================================================         |  86%
  |                                                                       
  |=========================================================        |  88%
  |                                                                       
  |===========================================================      |  90%
  |                                                                       
  |============================================================     |  92%
  |                                                                       
  |=============================================================    |  94%
  |                                                                       
  |==============================================================   |  96%
  |                                                                       
  |================================================================ |  98%
  |                                                                       
  |=================================================================| 100%

~~~



~~~{.r}
# 2. 시각화 위한 데이터 변환 ---------------------------------------------------
# 인접행렬(Adjacent Matrix)를 igraph 객체로 변환
my_network_g <- graph_from_adjacency_matrix(my_network, weighted=TRUE)

my_network_g$degree <- degree(my_network_g)

# 3. 시각화 ---------------------------------------------------
# threejs 동적 페이스북 그래프
graphjs(my_network_g, 
        layout=layout_with_fr(my_network_g, dim=3), 
        vertex.label.cex=0.5,
        edge.arrow.size=1,
        edge.curved=TRUE,
        vertex.size = jsonlite::toJSON(my_network_g$degree/20),
        vertex.color="darkkhaki",
        edge.color="darkgrey",
        vertex.label=V(my_network_g)$name)
~~~

<!--html_preserve--><div id="htmlwidget-28e145b95cdcc43d94ae" style="width:672px;height:480px;" class="scatterplotThree html-widget"></div>
<script type="application/json" data-for="htmlwidget-28e145b95cdcc43d94ae">{"x":{"NROW":52,"height":null,"width":null,"axis":false,"numticks":[6,6,6],"xticklabs":null,"yticklabs":null,"zticklabs":null,"color":["#BDB76B"],"size":[0.7,0,0.95,0.2,0,0.65,0.3,0.2,0,0,0.4,0,0.05,0.75,0.5,0.6,0.65,0.45,0.6,0,0.55,0.1,0.5,0.05,0.1,0,0.1,0,0,0.55,0.4,0.15,0.35,0.3,0.15,0.7,0.45,0.4,0.25,0.5,0,0.55,0,0.35,0.2,0.3,0.45,0.45,0.8,0.4,0.3,0.1],"stroke":"black","flipy":true,"grid":false,"renderer":"auto","signif":8,"bg":"white","cexsymbols":1,"xlim":[-1,1],"ylim":[-1,1],"zlim":[-1,1],"pch":["@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@","@"],"from":[[0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,5,5,5,5,5,5,5,5,6,6,10,10,10,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,18,18,18,20,20,20,20,20,20,21,22,22,22,22,22,29,29,29,29,29,29,30,30,30,31,32,32,33,34,35,35,35,35,35,35,35,35,35,36,36,36,36,37,37,37,37,38,38,39,39,39,39,39,41,41,41,41,41,41,43,43,45,45,45,46,46,46,46,47,47,47,47,48,48,48,48,48,48,48,48,48,48,48,49,49,49,50,50,50,51]],"to":[[10,16,20,29,35,39,43,47,51,5,10,13,16,17,18,29,32,33,35,38,39,41,49,14,2,7,15,16,26,33,36,38,16,39,22,43,48,6,10,15,20,22,33,34,43,44,50,3,15,20,22,44,5,7,13,14,18,30,35,0,5,6,12,22,29,39,44,29,32,41,48,2,5,20,23,24,30,45,0,13,14,24,36,46,45,6,10,14,31,39,0,16,17,18,33,36,15,46,48,22,17,46,13,45,2,3,7,14,15,26,30,33,36,5,29,35,50,41,46,48,49,2,47,2,3,6,31,44,17,32,37,46,47,49,48,50,18,21,34,20,30,32,37,0,38,41,49,7,10,17,18,30,32,35,37,43,47,49,37,41,47,13,36,43,0]],"lwd":1,"linealpha":1,"center":true,"main":[""],"vertexlabelcex":0.5,"edgearrowsize":1,"edgecurved":true,"lcol":["#A9A9A9"],"labels":["Youngjae Kim","Vance Han","Sung Kim","Kwon-Han Bae","Young-Suk Ahn","Jason Han","Junshik Jeon","Chungil Chae","Seungil Han","홍영택","Youngwook Kim","Won Soon Park","Jiwon Park","Terry Cho","Hyunsik Choi","Jin Young Kim","Hika Maeng","HeeChul Kim","Dylan Ko","ByungSik Choi","Yun Her","Jungin Yi","Chulhyun Cho","Song Yeong-min","Kwang Shick Kim","Ji-Won Chun","Choonghyun Ryu","Michael Lammbrau","Jaehee Hwang","Yongho Ha","Chan Yub Park","양충현","Sangjin Sim","Sabum Jung","이준영","정우준","Soo Kyung Lee","박경원","오민석","Dae Myung Clark Kang","Yunhwan Kim","Paruparo Zumba","김보근","Gyubin Park","한승진","Yong Hyun Kim","이상열","홍길한","Chisung  Song","Brian Lee","Harrison Jung","SungMin Jung"],"alpha":[1],"vertices":[[-0.24892709,-0.28806705,0.39381245,-0.24564788,-1,-0.91828312,-0.26707688,-0.28755411,0.22944255,-0.93584952,-0.25487014,0.23123446,0.25116045,-0.11746577,-1,-0.439493,-0.25050074,0.25671787,-0.65487902,-0.22470707,0.66142923,-0.59703947,-0.23941119,-0.11603068,1,0.16590987,0.20561154,-0.065945847,0.83926924,-0.45370822,-0.50102605,-0.19125432,0.20200636,0.55630621,0.66762961,-0.2510787,-0.30383884,-0.24740594,1,-0.52408709,-0.12196961,0.33716131,-0.76034427,-0.18500165,0.16010787,-0.55313345,-0.17008408,0.031222559,-0.42946424,-0.24669325,0.56227496,-0.0017439312,-0.2882256,0.060643303,-0.15619827,-0.06870226,0.096665663,0.66342403,0.20088282,-0.6967299,-0.39508691,-0.15294749,0.054232288,0.17851979,0.1995895,0.67203594,-0.76958819,-0.21892064,0.40788,0.31598656,0.048049925,0.10248948,-0.3322194,0.085604317,-0.23989315,-0.17697964,0.5755501,-0.83265095,-0.78691384,-0.37117322,-0.045820138,0.99421797,-0.5168914,0.029863204,-0.47128569,1,0.17600061,-0.15258894,-0.22659117,0.36103356,-0.380849,-0.20668075,-0.18096826,-1,-0.27079893,0.56611817,-0.038974982,-0.3149999,-0.16266384,-0.4195492,-0.30136351,0.45165004,-0.23416721,0.1409378,0.55582334,-0.52939051,-0.28435014,0.13332432,-0.38076078,-0.138622,0.35321958,-0.042758302,-0.36949224,-0.26406004,-0.089638039,-0.466935,0.32928704,-0.63344784,-0.29467526,0.4777324,0.81326621,-0.271015,-0.60088854,0.041435407,-0.39580621,-0.085294323,-0.74537402,0.73828364,-0.52640272,-0.31540702,-0.040403405,0.25153195,-0.79929698,-0.15265202,0.52135253,-0.0065155496,0.14490441,0.45261587,-0.19102543,-0.24228242,-0.25666775,-0.0098316335,-0.4461724,0.14823885,-0.2355779,-0.25715805,-0.020336844,-0.026517538,-0.48474211,-0.068270094,-0.44065496,-0.0062021727,0.52092846,-0.0023815013,-0.45989868,0.63742982]],"xticklab":["-1.00","-0.60","-0.20","0.20","0.60","1.00"],"yticklab":["-1.00","-0.60","-0.20","0.20","0.60","1.00"],"zticklab":["1.00","0.60","0.20","-0.20","-0.60","-1.00"],"xtick":[0,0.2,0.4,0.6,0.8,1],"ytick":[0,0.2,0.4,0.6,0.8,1],"ztick":[0,0.2,0.4,0.6,0.8,1]},"evals":[],"jsHooks":[]}</script><!--/html_preserve-->

~~~{.r}
# 애니메이션
# graphjs(my_network_g, 
#         layout=list(layout_randomly(my_network_g, dim=3),
#                     layout_on_sphere(my_network_g),
#                     layout_with_drl(my_network_g, dim=3),
#                     layout_with_fr(my_network_g, dim=3)),
#         main=list("random layout", "sphere layout", "drl layout", "fr layout"), fpl=300,
#         vertex.label.cex=0.5,
#         edge.arrow.size=3,
#         edge.curved=TRUE,
#         vertex.size = jsonlite::toJSON(my_network_g$degree/20),
#         vertex.color="darkkhaki",
#         edge.color="darkgrey",
#         vertex.label=V(my_network_g)$name)
~~~

