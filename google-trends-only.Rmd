---
layout: page
title: 데이터 과학자가 바라본 20대 총선
subtitle: 구글 추세(Trends)
output:
  html_document: 
    keep_md: yes
    toc: yes
  pdf_document:
    latex_engine: xelatex
mainfont: NanumGothic
---

```{r setOptions, message=FALSE, include=FALSE}
source("tools/chunk-options.R")

# 0. 환경설정 --------------------------------------------------
# devtools::install_github("PMassicotte/gtrendsR")
library(lubridate)
library(plotly)
library(gtrendsR)
library(tidyverse)
library(extrafont)
loadfonts()
par(family = "NanumBarunGothic")

# 1. 단일 검색어 추세 --------------------------------------------------
## 1.1. 데이터 가져오기
# moon_trend <- gtrends("문재인", time="2017-04-01 2017-05-01")
# hong_trend <- gtrends("홍준표", time="2017-04-01 2017-05-01")
# ahn_trend  <- gtrends("안철수", time="2017-04-01 2017-05-01")
# yoo_trend  <- gtrends("유승민", time="2017-04-01 2017-05-01")
# sim_trend  <- gtrends("심상정", time="2017-04-01 2017-05-01")

#saveRDS(moon_trend, "data/moon_trend.RDS")
#saveRDS(hong_trend, "data/hong_trend.RDS")
#saveRDS(ahn_trend, "data/ahn_trend.RDS")
#saveRDS(yoo_trend, "data/yoo_trend.RDS")
#saveRDS(sim_trend, "data/sim_trend.RDS")

# 2. 데이터 정제 --------------------------------------------------

moon_trend <- readRDS("data/moon_trend.RDS")
hong_trend <- readRDS("data/hong_trend.RDS")
ahn_trend  <- readRDS("data/ahn_trend.RDS")
yoo_trend  <- readRDS("data/yoo_trend.RDS")
sim_trend  <- readRDS("data/sim_trend.RDS")

trend_df <- moon_trend$interest_over_time %>% 
  bind_rows(hong_trend$interest_over_time) %>% 
  bind_rows(ahn_trend$interest_over_time) %>% 
  bind_rows(yoo_trend$interest_over_time) %>% 
  bind_rows(sim_trend$interest_over_time)

trend_df <- trend_df %>% mutate(date = ymd(date))

# 3. 데이터 시각화 --------------------------------------------------------
## 3.1. 추세 --------------------------------------------------------------
gtrend_g <- ggplot(trend_df,aes(x=date, y=hits, color=keyword)) +
  geom_line() +
  scale_x_date(date_labels="%m-%d") +
  theme_minimal() +
  theme(legend.position="none", 
        plot.caption=element_text(hjust=0,size=8),
        plot.subtitle=element_text(face="italic"),
        axis.text=element_text(size=7.5))+
  labs(x="",y="",title="후보별 구글 뉴스검색 추세",
       caption="\n 데이터출처: 구글, 구글 트렌드 도구(https://github.com/PMassicotte/gtrendsR)",
       subtitle="") +
  scale_colour_manual(name="",
                      values=c(문재인="#065ce8", 
                                  홍준표="#ff0000",
                                  안철수="#07f91f",
                                  유승민="#00faff",
                                  심상정="#f2ee09")) +
  geom_vline(xintercept=as.numeric(ymd("2017-04-19")), linetype=4, color="darkgrey", size=0.5) +
  geom_vline(xintercept=as.numeric(ymd("2017-04-23")), linetype=4, color="darkgrey", size=0.5) +
  geom_vline(xintercept=as.numeric(ymd("2017-04-25")), linetype=4, color="darkgrey", size=0.5) +
  geom_vline(xintercept=as.numeric(ymd("2017-04-28")), linetype=4, color="darkgrey", size=0.5) +
  annotate(geom="text",x=as.Date("2017-04-19"), y=3,label="KBS",fontface="bold", size=3) +
  annotate(geom="text",x=as.Date("2017-04-23"), y=3,label="1차",fontface="bold", size=3) +
  annotate(geom="text",x=as.Date("2017-04-25"), y=3,label="JTBC",fontface="bold", size=3) +
  annotate(geom="text",x=as.Date("2017-04-28"), y=3,label="2차",fontface="bold", size=3)
```

## 1. 구글 추세를 통해본 주요 대선후보

4월 1일부터 가장 최근 1개월 각 주요 대선후보별 추세를 보는 다음과 같다.


``` {r google-trend, echo=FALSE, fig.width=12}
ggplotly(gtrend_g)  %>%
  layout()

# 4. 표 --------------------------------------------------------------

DT::datatable(trend_df %>% dplyr::select(후보=keyword, date, hits) %>% 
                spread(후보, hits)) %>% 
  DT::formatCurrency(c(2:6), "", interval=3, mark=',', digits=0)
```


``` {r google-trend-setup, eval=FALSE}
# 0. 환경설정 --------------------------------------------------
# devtools::install_github("PMassicotte/gtrendsR")
library(lubridate)
library(plotly)
library(gtrendsR)
library(tidyverse)
library(extrafont)
loadfonts()
par(family = "NanumBarunGothic")

# 1. 단일 검색어 추세 --------------------------------------------------
## 1.1. 데이터 가져오기
moon_trend <- gtrends("문재인", time="2017-04-01 2017-05-01")
hong_trend <- gtrends("홍준표", time="2017-04-01 2017-05-01")
ahn_trend  <- gtrends("안철수", time="2017-04-01 2017-05-01")
yoo_trend  <- gtrends("유승민", time="2017-04-01 2017-05-01")
sim_trend  <- gtrends("심상정", time="2017-04-01 2017-05-01")


# 2. 데이터 정제 --------------------------------------------------


trend_df <- moon_trend$interest_over_time %>% 
  bind_rows(hong_trend$interest_over_time) %>% 
  bind_rows(ahn_trend$interest_over_time) %>% 
  bind_rows(yoo_trend$interest_over_time) %>% 
  bind_rows(sim_trend$interest_over_time)

trend_df <- trend_df %>% mutate(date = ymd(date))

# 3. 데이터 시각화 --------------------------------------------------------
## 3.1. 추세 --------------------------------------------------------------
gtrend_g <- ggplot(trend_df,aes(x=date, y=hits, color=keyword)) +
  geom_line() +
  scale_x_date(date_labels="%m-%d") +
  theme_minimal() +
  theme(legend.position="none", 
        plot.caption=element_text(hjust=0,size=8),
        plot.subtitle=element_text(face="italic"),
        axis.text=element_text(size=7.5))+
  labs(x="",y="",title="후보별 구글 뉴스검색 추세",
       caption="\n 데이터출처: 구글, 구글 트렌드 도구(https://github.com/PMassicotte/gtrendsR)",
       subtitle="") +
  scale_colour_manual(name="",
                      values=c(문재인="#065ce8", 
                                  홍준표="#ff0000",
                                  안철수="#07f91f",
                                  유승민="#00faff",
                                  심상정="#f2ee09")) +
  geom_vline(xintercept=as.numeric(ymd("2017-04-19")), linetype=4, color="darkgrey", size=0.5) +
  geom_vline(xintercept=as.numeric(ymd("2017-04-23")), linetype=4, color="darkgrey", size=0.5) +
  geom_vline(xintercept=as.numeric(ymd("2017-04-25")), linetype=4, color="darkgrey", size=0.5) +
  geom_vline(xintercept=as.numeric(ymd("2017-04-28")), linetype=4, color="darkgrey", size=0.5) +
  annotate(geom="text",x=as.Date("2017-04-19"), y=3,label="KBS",fontface="bold", size=3) +
  annotate(geom="text",x=as.Date("2017-04-23"), y=3,label="1차",fontface="bold", size=3) +
  annotate(geom="text",x=as.Date("2017-04-25"), y=3,label="JTBC",fontface="bold", size=3) +
  annotate(geom="text",x=as.Date("2017-04-28"), y=3,label="2차",fontface="bold", size=3)
```  
